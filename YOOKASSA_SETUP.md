# Настройка интеграции с ЮKassa

## Описание

В проекте интегрирована система приема платежей через ЮKassa для оплаты Premium подписки.

## Настройка

### 1. Переменные окружения

Добавьте в `.env.local` следующие переменные:

```bash
# ЮKassa настройки
YOOKASSA_SHOP_ID=1114551
YOOKASSA_SECRET_KEY=live_2-OAXwgLsRoO0vtxbq6qxtsxtJToqG6k03N1UV7jksE
NEXT_PUBLIC_APP_URL=http://localhost:3000

# Цены для премиум подписки (в рублях)
PREMIUM_MONTHLY_PRICE=299
PREMIUM_YEARLY_PRICE=2990
```

### 2. База данных

Модель `Payment` уже добавлена в Prisma схему и применена к базе данных.

### 3. API Endpoints

- `POST /api/payments/create` - создание платежа
- `POST /api/payments/webhook` - webhook для уведомлений от ЮKassa
- `GET /api/payments/status/[id]` - проверка статуса платежа

### 4. Настройка webhook в ЮKassa

В личном кабинете ЮKassa настройте webhook URL:

```
https://your-domain.com/api/payments/webhook
```

События для отслеживания:

- `payment.succeeded` - успешная оплата
- `payment.canceled` - отмена платежа

## Процесс оплаты

1. Пользователь выбирает тариф на странице `/premium`
2. Создается платеж через API ЮKassa
3. Пользователь перенаправляется на страницу оплаты ЮKassa
4. После оплаты пользователь возвращается на `/premium/success`
5. Webhook уведомляет о статусе платежа
6. При успешной оплате активируется Premium подписка

## Тестирование

### Тестовые карты ЮKassa:

- **Успешная оплата**: 5555555555554444
- **Отклонение**: 5555555555554477
- **3-D Secure**: 5555555555554495

Используйте любой CVC и дату из будущего.

## Компоненты

- `PremiumStatusCard` - отображение статуса подписки
- `usePremium` - хук для проверки Premium статуса
- Страницы: `/premium`, `/premium/success`

## Безопасность

- Все API endpoints защищены проверкой авторизации
- Webhook проверяет подлинность уведомлений
- Платежи создаются только для авторизованных пользователей
- Секретные ключи хранятся в переменных окружения

## Цены

- **Месячная подписка**: 299₽
- **Годовая подписка**: 2500₽

## Функции Premium

- Безлимитные расклады Таро
- Безлимитное общение с ИИ-гадалкой
- Эксклюзивные расклады
- Приоритетная поддержка
- Доступ к новым функциям
