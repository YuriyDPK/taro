export interface HoroscopeTemplate {
  category: "love" | "career" | "health" | "money" | "general";
  positive: string[];
  neutral: string[];
  challenging: string[];
  advice: string[];
}

export const horoscopeTemplates: Record<string, HoroscopeTemplate[]> = {
  aries: [
    {
      category: "love",
      positive: [
        "Сегодня ваша страстная натура привлечет к вам особое внимание. Возможна встреча с интересным человеком.",
        "Ваша харизма сегодня на пике! Отличный день для признаний и романтических свиданий.",
        "Энергия любви наполняет ваше сердце. Партнер будет восхищен вашей инициативностью.",
      ],
      neutral: [
        "В отношениях возможны как взлеты, так и небольшие разногласия. Сохраняйте баланс.",
        "День подходит для серьезных разговоров о будущем ваших отношений.",
        "Ваша прямолинейность может быть воспринята по-разному. Будьте деликатнее.",
      ],
      challenging: [
        "Избегайте импульсивных решений в любовных делах. Подумайте дважды перед действием.",
        "Возможны конфликты из-за вашего упрямства. Научитесь идти на компромиссы.",
        "Не позволяйте ревности затмить ваш разум. Доверие - основа крепких отношений.",
      ],
      advice: [
        "Проявите больше терпения к партнеру",
        "Выслушайте мнение любимого человека",
        "Планируйте романтический сюрприз",
        "Будьте более внимательны к деталям",
      ],
    },
    {
      category: "career",
      positive: [
        "Ваши лидерские качества сегодня особенно заметны. Коллеги будут прислушиваться к вашим идеям.",
        "Отличный день для начала новых проектов. Ваша энергия заразительна!",
        "Начальство оценит вашу инициативу. Возможно повышение или премия.",
      ],
      neutral: [
        "Сосредоточьтесь на завершении начатых дел, прежде чем браться за новые.",
        "Командная работа может принести неожиданные результаты.",
        "Будьте готовы к изменениям в рабочем графике.",
      ],
      challenging: [
        "Избегайте конфликтов с коллегами. Ваша прямота может быть неуместной.",
        "Не торопитесь с важными решениями. Консультируйтесь с опытными людьми.",
        "Контролируйте свой темперамент на рабочих встречах.",
      ],
      advice: [
        "Развивайте дипломатические навыки",
        "Слушайте мнения коллег",
        "Планируйте свои действия заранее",
        "Изучайте новые методы работы",
      ],
    },
  ],
  taurus: [
    {
      category: "love",
      positive: [
        "Ваша чувственность и надежность привлекают к вам искренние чувства.",
        "Стабильность в отношениях принесет глубокое удовлетворение.",
        "Романтический вечер дома создаст особую близость с партнером.",
      ],
      neutral: [
        "Избегайте упрямства в отношениях. Компромиссы укрепят связь.",
        "Материальная стабильность влияет на ваше эмоциональное состояние.",
        "Партнер может не разделять ваши взгляды на комфорт.",
      ],
      challenging: [
        "Ревность может разрушить доверие. Работайте над самооценкой.",
        "Не позволяйте материальным вопросам влиять на любовь.",
        "Ваша медлительность в принятии решений раздражает партнера.",
      ],
      advice: [
        "Выражайте чувства через заботу",
        "Создавайте уютную атмосферу",
        "Балуйте партнера приятными мелочами",
        "Будьте более гибкими",
      ],
    },
    {
      category: "career",
      positive: [
        "Ваша настойчивость и трудолюбие приведут к финансовому успеху.",
        "Коллеги ценят вашу надежность и практичный подход.",
        "Стабильная работа принесет желаемые плоды.",
      ],
      neutral: [
        "Избегайте сопротивления изменениям в рабочих процессах.",
        "Ваш консерватизм может замедлить карьерный рост.",
        "Сосредоточьтесь на качестве, а не на скорости.",
      ],
      challenging: [
        "Не отказывайтесь от новых возможностей из-за страха.",
        "Ваше упрямство мешает командной работе.",
        "Финансовые вопросы требуют более гибкого подхода.",
      ],
      advice: [
        "Изучайте новые технологии",
        "Развивайте коммуникативные навыки",
        "Инвестируйте в долгосрочные проекты",
        "Учитесь принимать изменения",
      ],
    },
  ],
  gemini: [
    {
      category: "love",
      positive: [
        "Ваше остроумие и общительность делают вас неотразимыми.",
        "Интеллектуальная связь с партнером выходит на новый уровень.",
        "Разнообразие в отношениях приносит радость и новизну.",
      ],
      neutral: [
        "Ваша переменчивость может сбивать партнера с толку.",
        "Потребность в свободе требует баланса с обязательствами.",
        "Избегайте поверхностности в серьезных разговорах.",
      ],
      challenging: [
        "Непостоянство в чувствах создает нестабильность.",
        "Флирт с другими может задеть партнера.",
        "Ваша потребность в новизне угрожает долгосрочным отношениям.",
      ],
      advice: [
        "Развивайте глубину в отношениях",
        "Слушайте партнера внимательно",
        "Планируйте совместные путешествия",
        "Изучайте что-то новое вместе",
      ],
    },
  ],
  cancer: [
    {
      category: "love",
      positive: [
        "Ваша заботливость создает атмосферу безопасности и любви.",
        "Интуитивное понимание потребностей партнера укрепляет связь.",
        "Семейные ценности объединяют вас с любимым человеком.",
      ],
      neutral: [
        "Эмоциональные перепады требуют понимания от партнера.",
        "Ваша привязанность к прошлому может мешать развитию отношений.",
        "Потребность в безопасности иногда ограничивает свободу.",
      ],
      challenging: [
        "Чрезмерная опека может душить партнера.",
        "Обидчивость разрушает гармонию в отношениях.",
        "Страх быть отвергнутым мешает открыться.",
      ],
      advice: [
        "Доверяйте своей интуиции",
        "Создавайте уютную домашнюю атмосферу",
        "Выражайте чувства открыто",
        "Учитесь прощать и отпускать",
      ],
    },
  ],
  leo: [
    {
      category: "love",
      positive: [
        "Ваш магнетизм сегодня неотразим! Вы в центре внимания противоположного пола.",
        "Романтика витает в воздухе. Идеальное время для грандиозных жестов любви.",
        "Ваша щедрость и теплота покоряют сердца. Партнер чувствует себя особенным.",
      ],
      neutral: [
        "Баланс между вниманием к себе и заботой о партнере принесет гармонию.",
        "Возможны драматические моменты в отношениях, но они укрепят вашу связь.",
        "Ваша потребность в восхищении может создать небольшое напряжение.",
      ],
      challenging: [
        "Не позволяйте гордыне разрушить отношения. Умейте просить прощения.",
        "Избегайте соперничества с партнером. Вы - команда, а не конкуренты.",
        "Ваше желание быть в центре внимания может задеть чувства любимого человека.",
      ],
      advice: [
        "Делитесь вниманием с партнером",
        "Цените простые моменты близости",
        "Выражайте благодарность чаще",
        "Организуйте особенное свидание",
      ],
    },
  ],
  pisces: [
    {
      category: "love",
      positive: [
        "Ваша интуиция подскажет правильные слова для выражения чувств.",
        "Глубокая эмоциональная связь с партнером достигнет нового уровня.",
        "Ваша способность к сочувствию создаст особую близость в отношениях.",
      ],
      neutral: [
        "Мечты о любви могут не совпадать с реальностью. Будьте реалистичнее.",
        "Ваша чувствительность требует деликатного обращения от партнера.",
        "Возможны недопонимания из-за ваших намеков вместо прямых слов.",
      ],
      challenging: [
        "Не идеализируйте партнера. Принимайте его таким, какой он есть.",
        "Избегайте жертвенности в ущерб своим потребностям.",
        "Ваша склонность к драматизации может усложнить простые ситуации.",
      ],
      advice: [
        "Говорите о своих чувствах открыто",
        "Устанавливайте здоровые границы",
        "Занимайтесь творчеством вместе",
        "Доверяйте своей интуиции",
      ],
    },
  ],
};

export const generateHoroscope = (
  signId: string,
  category: "love" | "career" | "health" | "money" | "general" = "general"
): string => {
  const templates = horoscopeTemplates[signId];
  if (!templates) {
    return "Звезды сегодня особенно благосклонны к вам. Доверьтесь своей интуиции.";
  }

  const categoryTemplate = templates.find((t) => t.category === category);
  if (!categoryTemplate) {
    return "Сегодня хороший день для новых начинаний и позитивных изменений.";
  }

  // Случайно выбираем тип предсказания
  const types = ["positive", "neutral", "challenging"] as const;
  const weights = [0.5, 0.3, 0.2]; // 50% позитивных, 30% нейтральных, 20% сложных

  let randomValue = Math.random();
  let selectedType: (typeof types)[number] = "positive";

  for (let i = 0; i < weights.length; i++) {
    if (randomValue < weights[i]) {
      selectedType = types[i];
      break;
    }
    randomValue -= weights[i];
  }

  const predictions = categoryTemplate[selectedType];
  const advice = categoryTemplate.advice;

  const prediction =
    predictions[Math.floor(Math.random() * predictions.length)];
  const tip = advice[Math.floor(Math.random() * advice.length)];

  return `${prediction} Совет дня: ${tip}.`;
};

export const getCompatibilityDescription = (
  sign1: string,
  sign2: string
): {
  score: number;
  description: string;
  advice: string;
} => {
  // Базовая совместимость по элементам
  const elementCompatibility: Record<string, Record<string, number>> = {
    fire: { fire: 8, earth: 4, air: 9, water: 3 },
    earth: { fire: 4, earth: 7, air: 5, water: 8 },
    air: { fire: 9, earth: 5, air: 8, water: 4 },
    water: { fire: 3, earth: 8, air: 4, water: 9 },
  };

  // Специальные совместимости
  const specialCompatibility: Record<
    string,
    Record<string, { score: number; description: string }>
  > = {
    aries: {
      leo: { score: 95, description: "Огненная страсть и взаимное восхищение" },
      sagittarius: { score: 90, description: "Приключения и общие цели" },
      libra: { score: 85, description: "Противоположности притягиваются" },
      cancer: { score: 30, description: "Слишком разные темпераменты" },
    },
    taurus: {
      virgo: { score: 92, description: "Идеальное понимание и стабильность" },
      capricorn: { score: 88, description: "Общие ценности и цели" },
      scorpio: { score: 85, description: "Магнетическое притяжение" },
      aquarius: { score: 25, description: "Кардинально разные взгляды" },
    },
    gemini: {
      libra: { score: 93, description: "Интеллектуальная гармония" },
      aquarius: { score: 89, description: "Свобода и понимание" },
      sagittarius: { score: 82, description: "Жажда знаний и приключений" },
      virgo: { score: 35, description: "Разные подходы к жизни" },
    },
  };

  const special =
    specialCompatibility[sign1]?.[sign2] ||
    specialCompatibility[sign2]?.[sign1];
  if (special) {
    return {
      score: special.score,
      description: special.description,
      advice: getCompatibilityAdvice(special.score),
    };
  }

  // Базовая совместимость (упрощенная версия)
  const baseScore = 60 + Math.floor(Math.random() * 30);

  return {
    score: baseScore,
    description: getGeneralCompatibilityDescription(baseScore),
    advice: getCompatibilityAdvice(baseScore),
  };
};

const getGeneralCompatibilityDescription = (score: number): string => {
  if (score >= 90) return "Идеальная пара с глубоким пониманием";
  if (score >= 80) return "Отличная совместимость с небольшими различиями";
  if (score >= 70) return "Хорошие отношения при взаимных усилиях";
  if (score >= 60) return "Средняя совместимость, требует работы";
  if (score >= 50) return "Сложные отношения, но возможны";
  return "Очень разные характеры, нужно много терпения";
};

const getCompatibilityAdvice = (score: number): string => {
  if (score >= 90) return "Наслаждайтесь гармонией и поддерживайте друг друга";
  if (score >= 80) return "Цените различия и учитесь друг у друга";
  if (score >= 70) return "Работайте над компромиссами и общением";
  if (score >= 60) return "Развивайте терпение и понимание";
  if (score >= 50) return "Фокусируйтесь на общих интересах";
  return "Принимайте различия как возможность для роста";
};
